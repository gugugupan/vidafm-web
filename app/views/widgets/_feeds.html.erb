<%# 
	Usage :
		Create a feed bubble~

	Params :
		boxtype - [ "datebox" , "userbox" (define)]
%>
<% boxtype = "userbox" if boxtype .nil? -%>
<div class="feed"> <!-- feeds id missed 'moment1325523'-->
	<div class="mlcontainer"> 
		<div class="mlbox">

			<%# Activity feed %>
			<% if feeds[ "feed_type" ] == "activity_feed" -%>
				<% mid = feeds[ 'moment' ] [ 'id' ] -%>
				<%= link_to feeds[ 'moment' ] [ 'likes_count' ] , like_moment_url( mid ) , :remote => true , :method => :put , :id => "like#{ mid }" , :class =>"float_likes #{ feeds[ 'moment' ] [ 'liked' ] ? 'liked' : 'unlike' }" %>
				<% if boxtype == "userbox" -%>
					<%= avatar_tag_b( feeds[ "user" ] , { :class => "float_avatar" } ) %>
				<% else -%>
					<%= datebox_tag( get_time( feeds[ "moment" ] ) ) %>
				<% end -%>
				<div class="image_container">
					<%= render :partial => "widgets/puzzle" , :object => feeds[ "activities" ] [ 0 , 9 ] %>
					<div class="clearfix"> </div>
				</div>
				<div class="mlinfo" style="padding-left: 50px;">
					<%= link_to "/moments/#{ feeds[ "moment" ] [ "id" ] }" , :class => "gotoslideshow" do -%>
						<%= image_tag "slideshow/btn_play.png" -%>
					<% end -%>
					<% feeds[ "moment" ] [ "created_at" ] = feeds[ "created_at" ] -%>
					<p class="mltitle">#<%= moment_category_by_num feeds[ "moment" ] [ "category_id" ] %> <%= moment_name feeds[ "moment" ] %> </p>
					<div class="mldata">
						<p class="mlnumber"> <%= feeds[ "moment" ] [ "activity_count" ] %> </p>
						<p class="mltime"> <%= time_ago_now( get_time( feeds ) ) %>前 </p>
						<div class="clearfix"></div>
					</div>
					<div class="clearfix"></div>
				</div>
				<div class="clearfix"></div>

				<%= image_tag "icon/icon_timeline_story.png" , :class => "feeds_icon feeds_icon_left" -%>
				<%= image_tag "icon/icon_timeline_story.png" , :class => "feeds_icon feeds_icon_right" -%>
			<% end -%>

			<%# Comment feed %>
			<% if feeds[ "feed_type" ] == "comment_feed" -%>
				<div class="mlcommentlike">
					<%= avatar_tag_b( feeds[ "user" ] , { :class => "mlcommentlike_image_left" } ) %>
					<%= image_tag "icon/icon_small_comment.png" , :class => "mlcommentlike_icon" %>
					<div class="mlcommentlike_content">
						<p> 
							<span>评论了</span> <%= feeds[ "content" ] -%>
						</p>
						<p class="mltime"> <%= time_ago_now( get_time( feeds ) ) %>前 </p>
					</div>
					<% if feeds[ "type" ] == "moment" -%>
						<%= link_to image_tag( "feeds/story_thum_mask.png" ) , "/moments/#{ feeds[ "moment" ] [ "id" ] }?md=ms" , :class => "mlcommentlike_image_right" , :style => "background:url('#{ feeds[ "moment" ] [ "image_small" ] }') no-repeat scroll center center white; background-size: cover;" -%>
					<% else #is activity -%>
						<%= link_to "" , "/activities/#{ feeds[ "activity" ] [ "id" ] }?md=ms" , :class => "mlcommentlike_image_right" , :style => "background:url('#{ feeds[ "activity" ] [ "image_small" ] }') no-repeat scroll center center white; background-size: cover;" -%>
					<% end -%>
					<div class="clearfix"> </div>
				</div>
				<%= image_tag "icon/icon_timeline_comment.png" , :class => "feeds_icon feeds_icon_left" -%>
				<%= image_tag "icon/icon_timeline_comment.png" , :class => "feeds_icon feeds_icon_right" -%>
			<% end -%>

			<%# Like feed %>
			<% if feeds[ "feed_type" ] == "like_feed" -%>
				<div class="mlcommentlike">
					<% for user in feeds[ "users" ] do -%>
						<%= avatar_tag_b user , { :class => "mlcommentlike_image_left" } %>
					<% end -%>
					<%= image_tag "icon/icon_small_like.png" , :class => "mlcommentlike_icon" %>

					<% if feeds[ "type" ] == "moment" -%>
						<% feeds[ "moment" ] [ "created_at" ] = feeds[ "created_at" ] -%>
						<div class="mlcommentlike_content" style="width:<%=225-45*(feeds[ "users" ].length-1)-%>px">
							<p> 
								<span>喜欢了</span> #<%= moment_category_by_num feeds[ "moment" ] [ "category_id" ] %> <%= moment_name( feeds[ "moment" ] ) -%>
							</p>
							<p class="mltime"> <%= time_ago_now( get_time( feeds ) ) %>前 </p>
						</div>
						<%= link_to image_tag( "feeds/story_thum_mask.png" ) , "/moments/#{ feeds[ "moment" ] [ "id" ] }?md=ms" , :class => "mlcommentlike_image_right" , :style => "background:url('#{ feeds[ "moment" ] [ "image_small" ] }') no-repeat scroll center center white; background-size: cover;" -%>
					<% else #is activity -%>
						<div class="mlcommentlike_content" style="width:90px">
							<p> 
								<span>喜欢了</span>
							</p>
							<p class="mltime"> <%= time_ago_now( get_time( feeds ) ) %>前 </p>
						</div>
						<% for activity in feeds[ "activities" ] [ 0 , 3 ] do -%>
							<%= link_to "" , "/activities/#{ activity[ "id" ] }?md=ms" , :class => "mlcommentlike_image_right" , :style => "background:url('#{ activity[ "image_small" ] }') no-repeat scroll center center white; background-size: cover;" -%>
						<% end -%>
					<% end -%>
					<div class="clearfix"> </div>
				</div>
				<%= image_tag "icon/icon_timeline_like.png" , :class => "feeds_icon feeds_icon_left" -%>
				<%= image_tag "icon/icon_timeline_like.png" , :class => "feeds_icon feeds_icon_right" -%>
			<% end -%>

			<%= image_tag "images/mlarrow_right.png" , :class => "mlarrow mlarrow_right" %>
			<%= image_tag "images/mlarrow_left.png" , :class => "mlarrow mlarrow_left" %> 
		</div>
	</div>
	<div class="clearfix"> </div>
</div>
