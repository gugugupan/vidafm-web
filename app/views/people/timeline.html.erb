<%= content_for :title do %>
  <%= "#{@user['name']} 的生活轨迹 - VIDA（唯达） - 你我的生活轨迹" %>
<% end -%>

<%= content_for :meta_description do %>
	<%= "#{@user['name']}正在用 vida 记录生活轨迹"  %>
<%  end-%>

<div id="person_timeline_page">
  <div id="fixed_box"> <%= render :partial => "people/timeline", :locals => {:first_moment_created_at => @user['first_moment_created_at']} %> </div>
  <div id="moments">
  	<% if @user['first_moment_created_at'].nil? %>
  		<% if @current_user and @current_user['id'] == @user['id'] %>
  			<%= render :partial => "people/self_null" %>
		<% else %>
  			<%= render :partial => "people/others_null" %>
		<% end %>
  	<% end -%>
  </div>
</div>
		

<script type="text/javascript">
	$(function() {
		// 放置被查看用户的特定年月的moments
		setMoments = function( user_id, year, month ) {
			$.get("/people/" + user_id + "/moments.js?year=" +  year + "&month=" + month, function () {
				if ($("#moments").html() == "") {
				} else {
					$("#moments .photos img").lazyload({effect : "fadeIn"});	
				}
			});
		};

		$(window).bind("hashchange", function() {
			var now = new Date(),
				user_id = <%= @user['id'] %>,
				year = $.bbq.getState("year") || now.getFullYear(),
				month = $.bbq.getState("month") || now.getMonth() + 1;


			$(".timeline_item.selected").removeClass("selected");
			$(".timeline_item[href$='year=" + year + "&month=" + month + "']").addClass("selected");

			<% unless @user['first_moment_created_at'].nil? %>
				setMoments(user_id, year, month);
			<% end %>
		});

		$(window).trigger("hashchange")
	})
</script>	
